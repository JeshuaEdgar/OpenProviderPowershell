name: Publish module to PowerShellGallery
on:
  release:
    types: [published]
  
jobs:
  publish:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - name: Publish Module
      run: | 
        $directory = Get-ChildItem . -Recurse | Where-Object {$_.Name -eq "OpenProviderPowershell.psd1"} | Get-Item | Select -ExpandProperty directoryName
        $publishSplat = @{NuGetApiKey = "${{ secrets.PS_GALLERY_KEY }}"; Path = $directory }
        Publish-Module @publishSplat -Verbose
      shell: pwsh
